@charset "UTF-8";

/* =========================================
   1. 核心变量与重置 (Mobile Core)
   ========================================= */
:root {
    /* 配色方案 (保留了你原来的古风色调) */
    --main-color: #4a3b52;    /* 绛紫：主色 */
    --bg-color: #f5f5f7;      /* 浅灰：背景 (更护眼) */
    --panel-bg: #ffffff;      /* 纯白：面板 */
    --text-color: #333333;    /* 墨色：正文 */
    --accent-color: #c0392b;  /* 朱砂：强调/战斗 */
    --secondary-color: #8e44ad; /* 紫：特殊 */
    --border-color: #ebedf0;  /* 边框淡色 */
    
    /* 安全区域 (刘海屏适配) */
    --safe-top: env(safe-area-inset-top, 20px);
    --safe-bottom: env(safe-area-inset-bottom, 20px);
}

* {
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent; /* 去除点击蓝框 */
    touch-action: manipulation; /* 优化点击延迟 */
    user-select: none; /* 禁止长按选中文字 (提升APP感) */
}

/* 允许输入框选中 */
input, textarea { user-select: text; }

body {
    font-family: -apple-system, "Microsoft YaHei", sans-serif;
    background-color: var(--bg-color);
    color: var(--text-color);
    margin: 0;
    padding: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden; /* 禁止整体滚动，交给内部容器 */
    display: flex;
    flex-direction: column;
}

/* =========================================
   2. 开始界面 & 捏脸 (Start Screen)
   ========================================= */
#startScreen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, #fdfbf7 0%, #e0eafc 100%);
    z-index: 200;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
}

.start-card {
    background: white;
    width: 100%;
    max-width: 360px;
    padding: 30px 20px;
    border-radius: 20px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    text-align: center;
}

/* Roll点区域优化 */
.roll-box {
    display: flex;
    justify-content: space-between;
    background: #f8f9fa;
    padding: 15px 5px;
    border-radius: 12px;
    margin: 20px 0;
}
.roll-item label { font-size: 12px; color: #999; display: block; margin-bottom: 5px; }
.roll-val { font-size: 20px; font-weight: bold; }
.roll-val.power { color: #d35400; }
.roll-val.int { color: #2980b9; }
.roll-val.charm { color: #e91e63; }
.roll-divider { width: 1px; background: #ddd; }

/* 剧情界面 */
#introScreen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #1a1a1a;
    color: #ecf0f1;
    z-index: 150;
    display: none; /* JS控制显示 */
    flex-direction: column;
    padding: 40px 20px;
}
.story-container {
    flex: 1;
    overflow-y: auto;
    font-size: 16px;
    line-height: 1.8;
    text-align: justify;
}
.click-hint {
    text-align: center;
    color: #666;
    font-size: 12px;
    margin-top: 20px;
    animation: blink 2s infinite;
}

/* =========================================
   3. App Shell 框架 (核心布局)
   ========================================= */
#app-shell {
    flex: 1;
    display: flex;
    flex-direction: column;
    height: 100%;
    background: var(--bg-color);
}

/* --- A. 顶部 Header --- */
.app-header {
    height: 60px;
    flex-shrink: 0;
    background: white;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 15px;
    padding-top: var(--safe-top); /* 避开刘海 */
    box-sizing: content-box; /* 让高度不包含 padding */
}

.header-user {
    display: flex;
    align-items: center;
    gap: 10px;
}
.header-avatar {
    width: 40px; height: 40px;
    border-radius: 50%;
    background: #eee;
    overflow: hidden;
    border: 2px solid var(--main-color);
}
.header-avatar img { width: 100%; height: 100%; object-fit: cover; }

.header-info { display: flex; flex-direction: column; justify-content: center; }
.name-row { font-weight: bold; font-size: 15px; display: flex; align-items: center; gap: 5px; }
.badge { background: var(--main-color); color: white; font-size: 10px; padding: 1px 4px; border-radius: 4px; }
.status-row { font-size: 11px; color: #666; }
.ap-badge { color: #f1c40f; font-weight: bold; margin-left: 5px; }

.header-stats {
    display: flex;
    gap: 10px;
    font-size: 12px;
    color: #555;
}

/* --- B. 中间 Content --- */
.app-content {
    flex: 1;
    overflow-y: auto; /* 允许滚动 */
    padding: 15px;
    display: flex;
    flex-direction: column;
    gap: 15px;
    /* 底部留出空间给 TabBar */
    padding-bottom: calc(60px + var(--safe-bottom)); 
}

/* 场景区域 */
.scene-section {
    background: white;
    border-radius: 12px;
    padding: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.03);
}
.section-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    font-weight: bold;
    color: var(--main-color);
}
/* 场景操作按钮容器 (ui.js 生成的按钮) */
#scene-action-area {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
}

/* NPC 列表 */
.npc-list {
    display: flex;
    flex-direction: column;
    gap: 10px;
}
/* NPC 卡片样式 (兼容 ui.js 生成的结构) */
.npc-card {
    background: white;
    border-radius: 10px;
    padding: 10px;
    display: flex;
    align-items: center;
    gap: 12px;
    border: 1px solid var(--border-color);
}
.npc-card:active { background: #f9f9f9; transform: scale(0.99); }
.npc-avatar { width: 50px; height: 50px; border-radius: 8px; flex-shrink: 0; }
.npc-info { flex: 1; }
.npc-name { font-weight: bold; font-size: 15px; }
.npc-desc { font-size: 12px; color: #777; margin-top: 3px; }

/* --- C. 底部 Footer (TabBar) --- */
.app-tabbar {
    height: 55px;
    position: fixed;
    bottom: 0; left: 0; width: 100%;
    background: white;
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: space-around;
    align-items: center;
    padding-bottom: var(--safe-bottom);
    z-index: 100;
}
.tab-item {
    flex: 1;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    color: #999;
    font-size: 10px;
    height: 100%;
}
.tab-item:active { color: var(--main-color); background: #fcfcfc; }
.tab-item i { font-size: 20px; margin-bottom: 3px; }
.tab-item span { transform: scale(0.9); }

/* =========================================
   4. 弹窗系统 (Modals)
   ========================================= */
.modal-overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(0,0,0,0.5); /* 半透明黑底 */
    z-index: 1000;
    display: none; /* JS控制 flex/block */
    /* 默认居中对齐 (用于 Center Modal) */
    align-items: center; 
    justify-content: center;
    backdrop-filter: blur(3px);
}

/* 通用 Modal 容器 */
.modal {
    background: white;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}

/* 类型1: 底部抽屉 (Bottom Sheet) */
.bottom-sheet {
    position: absolute;
    bottom: 0; left: 0;
    width: 100%;
    max-height: 85vh; /* 不超过屏幕 85% */
    border-radius: 20px 20px 0 0;
    animation: slideUp 0.3s ease-out;
}

/* 类型2: 全屏弹窗 (Full Screen) */
.full-screen-modal {
    width: 100%; height: 100%;
    border-radius: 0;
}

/* 类型3: 居中弹窗 (Center - Alert/Confirm) */
.center-modal {
    width: 85%;
    max-width: 320px;
    border-radius: 12px;
    padding: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.2);
    animation: popIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
}

/* Modal 内部结构 */
.modal-header {
    padding: 15px;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-shrink: 0;
}
.modal-header h3 { margin: 0; font-size: 18px; color: var(--main-color); }
.close-btn { font-size: 24px; color: #ccc; padding: 0 10px; }

.scroll-box {
    flex: 1;
    overflow-y: auto;
    padding: 15px;
    -webkit-overflow-scrolling: touch;
}

/* 角色详情弹窗适配 */
.modal-detail {
    width: 100%; height: 100%;
    background: #f8f9fa;
    display: flex;
    flex-direction: column;
    overflow-y: auto;
}
.detail-left {
    background: white;
    padding: 20px;
    display: flex;
    align-items: center;
    gap: 15px;
    border-bottom: 1px solid #eee;
}
.detail-left .avatar-box { width: 80px; height: 80px; }
.detail-center { padding: 15px; }
.detail-attr-row {
    display: flex; justify-content: space-between;
    padding: 10px 0; border-bottom: 1px dashed #eee;
    font-size: 14px;
}
.detail-right { 
    background: white; 
    padding: 15px; 
    position: sticky; bottom: 0; /* 吸底按钮区 */
    box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
}
/* 强制让 ui.js 生成的按钮组变成网格 */
.modal-actions {
    display: grid !important;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}

/* =========================================
   5. 组件与工具类 (Components)
   ========================================= */
/* 按钮基础 */
.btn {
    border: none;
    border-radius: 8px;
    padding: 12px 20px;
    font-size: 15px;
    font-weight: 500;
    cursor: pointer;
    transition: transform 0.1s;
    display: inline-flex; justify-content: center; align-items: center;
}
.btn:active { transform: scale(0.96); opacity: 0.9; }

/* 颜色变体 */
.btn-primary { background: var(--main-color); color: white; }
.btn-accent { background: var(--accent-color); color: white; }
.btn-secondary { background: #e0e0e0; color: #333; }
.btn-mini { padding: 5px 10px; font-size: 12px; border-radius: 4px; background: #eef; color: var(--main-color); border:none;}
.full-width { width: 100%; }

.btn-group { display: flex; gap: 10px; margin-top: 20px; }
.btn-group .btn { flex: 1; }

/* 输入框 */
.modal-input {
    width: 100%;
    padding: 12px;
    border: 1px solid #ddd;
    border-radius: 8px;
    font-size: 16px; /* 防止iOS自动放大 */
    margin-bottom: 15px;
}

/* 动画定义 */
@keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
@keyframes popIn { from { transform: scale(0.8); opacity: 0; } to { transform: scale(1); opacity: 1; } }
@keyframes blink { 0%,100%{opacity:1} 50%{opacity:0.3} }

/* =========================================
   6. 兼容性补丁 (Legacy Shim)
   ========================================= */
/* 隐藏旧版不需要的元素 */
#orientation-lock { display: none !important; }

/* 防止 ui.js 操作 .game-area 时失效 */
/* 我们实际上把 #app-shell 当作以前的 game-area 用 */
.game-area { display: flex !important; flex-direction: column; height: 100%; }
/* =========================================
   7. 捏脸界面紧急修复补丁 (放在文件最末尾)
   ========================================= */

/* 针对手机横屏 (高度不够时) 的特殊布局 */
@media screen and (max-height: 600px) {
    
    /* 1. 让整个弹窗变成“左右布局” (左边选属性，右边看预览) */
    /* 注意：因为我们 HTML 结构是 上-中-下，这里用 Grid 强行改变布局 */
    .char-creator-modal {
        display: grid !important;
        grid-template-columns: 1fr 200px; /* 左边自适应，右边固定 200px */
        grid-template-rows: auto 1fr;     /* 上面标题自适应，下面内容撑满 */
        width: 95% !important;
        height: 95% !important;
        max-width: none !important;
    }

    /* 2. 标题栏 (放在左上角) */
    .creator-header {
        grid-column: 1 / 2;
        grid-row: 1 / 2;
        padding: 5px !important;
        border-bottom: 1px dashed #eee;
    }
    .creator-header h3 { font-size: 14px !important; margin: 0 !important; }

    /* 3. 选项区域 (放在左下角，占据主要空间) */
    .creator-body {
        grid-column: 1 / 2;
        grid-row: 2 / 3;
        padding: 5px !important;
        overflow-y: auto !important;
    }
    /* 让选项排成两列，更省空间 */
    .creator-controls {
        display: grid;
        grid-template-columns: 1fr 1fr; 
        gap: 5px;
    }

    /* 4. 底部预览区域 (挪到右边，变成侧边栏) */
    .creator-footer {
        grid-column: 2 / 3;
        grid-row: 1 / 3; /* 跨越整个右侧 */
        border-top: none !important;
        border-left: 1px solid #eee;
        display: flex !important;
        flex-direction: column !important;
        justify-content: center !important; /* 内容垂直居中 */
        padding: 10px !important;
        background: #fdfdfd;
    }

    /* 5. 缩小头像和文字，确保按钮能露出来 */
    .avatar-preview {
        transform: scale(0.7); /* 强制缩小头像 70% */
        margin-bottom: 5px !important;
    }
    .desc-preview {
        font-size: 10px !important;
        height: 60px; /* 限制文字高度 */
        overflow-y: auto;
        margin-bottom: 10px !important;
        display: block !important; /* 确保显示 */
    }

    /* 6. 按钮加粗显眼 */
    .creator-footer .btn {
        width: 100% !important;
        padding: 8px 0 !important;
        font-size: 14px !important;
        background: var(--accent-color) !important; /* 醒目的红色 */
    }
}

/* 针对竖屏手机 (屏幕特别窄时) */
@media screen and (max-width: 400px) {
    .creator-footer {
        padding: 10px !important;
    }
    .avatar-preview {
        transform: scale(0.8); /* 稍微缩小头像 */
    }
    .btn {
        padding: 10px !important; /* 按钮变紧凑 */
    }
}